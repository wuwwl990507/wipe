/*!wipe-wwl 1.0.1 发布日期：2018-11-14*/
var cas=document.getElementById("cas"),context=cas.getContext("2d"),_w=cas.width,_h=cas.height,t=0,radius=30,posX=0,posY=0,isMouseDown=!1,device=/android | webos | iPhone | ipad | ipod | blackberry | iemobile | opera mini/i.test(navigator.userAgent.toLowerCase());console.log(navigator.userAgent),console.log(device);var clickEvtName=device?"touchstart":"mousedown",moveEvtName=device?"touchmove":"mousemove",endEvtName=device?"touchend":"mouseup";function drawT(e,t,o,n,a){if(3===arguments.length)e.save(),e.beginPath(),e.arc(t,o,radius,0,2*Math.PI),e.fillStyle="red",e.fill(),e.restore();else{if(5!==arguments.length)return!1;e.save(),e.lineCap="round",e.lineWidth=2*radius,e.beginPath(),e.moveTo(t,o),e.lineTo(n,a),e.stroke(),e.restore()}}function drawMask(e){e.fillStyle="#666",e.fillRect(0,0,_w,_h),e.globalCompositeOperation="destination-out"}function clearRect(e){e.clearRect(0,0,_w,_h)}function getTransparencyPercent(e){for(var o=e.getImageData(0,0,_w,_h),n=0;n<o.data.length;n+=4){0===o.data[n+3]&&t++}var a=t/(_w*_h)*100;return console.log("透明点的个数："+t),console.log("占总面积"+Math.round(a)+"%"),Math.round(a)}cas.addEventListener(clickEvtName,function(e){isMouseDown=!0;var t=e||window.event;posX=device?t.touches[0].clientX:t.clientX,posY=device?t.touches[0].clientY:t.clientY,drawT(context,posX,posY)},!1),cas.addEventListener(moveEvtName,function(e){if(!isMouseDown)return!1;var t=e||window.event;t.preventDefault();var o=device?t.touches[0].clientX:t.clientX,n=device?t.touches[0].clientY:t.clientY;drawT(context,posX,posY,o,n),posX=o,posY=n},!1),cas.addEventListener(endEvtName,function(){isMouseDown=!1,50<getTransparencyPercent(context)&&(alert("超过了50%的面积"),clearRect(context))},!1),window.onload=function(){drawMask(context)};